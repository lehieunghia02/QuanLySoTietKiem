@model IEnumerable<QuanLySoTietKiem.Models.SavingAccountModel>
@{
    ViewData["Title"] = "Savings Accounts";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

    <!-- Page Header -->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2 class="page-title">Savings Accounts</h2>
        <a asp-action="OpenSavingsAccount" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i>
            Add Savings Account
        </a>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="Search savings accounts..." />
                <button id="searchButton" class="btn btn-primary">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </div>
        <div class="col-md-3">
            <select id="sortDropdown" class="form-select">
                <option value="">Sort by customer name</option>
                <option value="asc">A-Z</option>
                <option value="desc">Z-A</option>
            </select>
        </div>
        <div class="col-md-3">
            <button id="exportExcelBtn" class="btn btn-success w-100">
                <i class="bi bi-download"></i>
                Export Excel
            </button>
        </div>
    </div>

    <!-- Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered" id="savingsTable">
            <thead class="table-primary">
                <tr>
                    <th width="40">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="selectAll" />
                        </div>
                    </th>
                    <th width="50">#</th>
                    <th>Customer</th>
                    <th>Deposit Amount</th>
                    <th>Term</th>
                    <th>Opened Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input row-checkbox"
                                    data-id="@item.MaSoTietKiem" />
                            </div>
                        </td>
                        <td>@item.MaSoTietKiem</td>
                        <td class="user-id">@item.UserId</td>
                        <td>@item.SoTienGui.ToString("N0") VNĐ</td>
                        <td>@item.KyHan tháng</td>
                        <td>@item.NgayMoSo.ToString("dd/MM/yyyy")</td>
                        <td>
                            @if (item.TrangThai == true)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">Pending</span>
                            }
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a asp-action="Details" asp-route-id="@item.MaSoTietKiem"
                                    class="btn btn-sm btn-outline-info">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a asp-action="AddMoney" asp-route-id="@item.MaSoTietKiem"
                                    class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-plus-circle"></i>
                                </a>
                                <a asp-action="WithdrawMoney" asp-route-id="@item.MaSoTietKiem"
                                    class="btn btn-sm btn-outline-warning">
                                    <i class="bi bi-dash-circle"></i>
                                </a>
                                <button class="btn btn-sm btn-outline-danger" onclick="confirmDelete('@item.MaSoTietKiem')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

@section Scripts {
    <script>
        // Confirm delete
        function confirmDelete(id) {
            if (confirm('Are you sure you want to delete this savings account?')) {
                window.location.href = '/SoTietKiem/Delete/' + id;
            }
        }

        // Search
        document.getElementById('searchButton').addEventListener('click', function () {
            searchSavingsAccounts();
        });

        document.getElementById('searchInput').addEventListener('keyup', function (e) {
            if (e.key === 'Enter') {
                searchSavingsAccounts();
            }
        });

        function searchSavingsAccounts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#savingsTable tbody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Sort
        document.getElementById('sortDropdown').addEventListener('change', function (e) {
            const sortOrder = e.target.value;
            const tbody = document.querySelector('#savingsTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            if (sortOrder) {
                rows.sort((a, b) => {
                    const aValue = a.querySelector('.user-id').textContent.trim();
                    const bValue = b.querySelector('.user-id').textContent.trim();

                    if (sortOrder === 'asc') {
                        return aValue.localeCompare(bValue);
                    } else {
                        return bValue.localeCompare(aValue);
                    }
                });

                // Clear tbody
                while (tbody.firstChild) {
                    tbody.removeChild(tbody.firstChild);
                }

                // Append sorted rows
                rows.forEach(row => tbody.appendChild(row));
            }
        });

        // Select all checkboxes
        document.getElementById('selectAll').addEventListener('change', function (e) {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = e.target.checked);
        });

        // Export Excel
        document.getElementById('exportExcelBtn').addEventListener('click', function () {
            window.location.href = '/SoTietKiem/ExportToExcel';
        });
    </script>
}